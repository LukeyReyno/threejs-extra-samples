(()=>{"use strict";var e,t={424:function(e,t,n){var o,r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),a=0;a<n.length;a++)"default"!==n[a]&&r(t,e,n[a]);return i(t,e),t}),s=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const l=a(n(437)),c=n(246),d=n(351),u=new l.Clock,p="./textures/mono_equirect_test.png";let y,f,v,h,m,x,w,g,b,M,S,E,D=!1;const O=()=>s(void 0,void 0,void 0,(function*(){const e=m.xr.getSession();if(e&&e.renderState.layers){if(g&&(v.remove(g),g.geometry.dispose(),Array.isArray(g.material)?g.material.forEach((e=>e.dispose())):g.material.dispose(),g=null),!w){const e=new l.TextureLoader;w=yield e.loadAsync(p)}e.requestReferenceSpace("local-floor").then((t=>{b=m.xr.getBinding().createEquirectLayer({space:t,viewPixelWidth:w.image.width,viewPixelHeight:w.image.height,textureType:"texture",layout:"mono"});const n=e.renderState.layers||[],o=[b,...n];console.log("New layers:",o),null==e||e.updateRenderState({layers:o})}))}})),R=()=>{D=!0},L=()=>{f.aspect=window.innerWidth/window.innerHeight,f.updateProjectionMatrix(),m.setSize(window.innerWidth,window.innerHeight)},T=(e,t)=>{const n=60*u.getDelta();if(D&&(O(),D=!1),b&&b.needsRedraw){let e=m.xr.getBinding().getSubImage(b,t),n=m.getContext();n.bindTexture(n.TEXTURE_2D,e.colorTexture),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,w.image),n.bindTexture(n.TEXTURE_2D,null)}h.setFromXRController(M);const o=h.intersectObjects(x.children,!1);o.length>0?E!=o[0].object&&(E&&E.material.emissive.setHex(E.currentHex),E=o[0].object,E.currentHex=E.material.emissive.getHex(),E.material.emissive.setHex(16711680)):(E&&E.material.emissive.setHex(E.currentHex),E=void 0);for(let e=0;e<x.children.length;e++){const t=x.children[e];t.userData.velocity.multiplyScalar(1-.001*n),t.position.add(t.userData.velocity);const o=.5;(t.position.x<-o||t.position.x>o)&&(t.position.x=l.MathUtils.clamp(t.position.x,-o,o),t.userData.velocity.x=-t.userData.velocity.x),(t.position.y<0||t.position.y>1)&&(t.position.y=l.MathUtils.clamp(t.position.y,0,1),t.userData.velocity.y=-t.userData.velocity.y),(t.position.z<-o||t.position.z>o)&&(t.position.z=l.MathUtils.clamp(t.position.z,-o,o),t.userData.velocity.z=-t.userData.velocity.z),t.rotation.x+=2*t.userData.velocity.x*n,t.rotation.y+=2*t.userData.velocity.y*n,t.rotation.z+=2*t.userData.velocity.z*n}m.render(v,f)};(()=>{y=document.createElement("div"),document.body.appendChild(y),v=new l.Scene,v.background=new l.Color(24720),f=new l.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.1,2e3),f.position.set(0,1.6,3),v.add(f),x=new l.Object3D,v.add(x),v.add(new l.HemisphereLight(10855845,9013641,3));const e=new l.DirectionalLight(16777215,3);e.position.set(1,1,1).normalize(),v.add(e);const t=new l.BoxGeometry(.15,.15,.15);for(let e=0;e<20;e++){const e=new l.Mesh(t,new l.MeshLambertMaterial({color:16777215*Math.random()}));e.position.x=4*Math.random()-2,e.position.y=4*Math.random(),e.position.z=4*Math.random()-2,e.rotation.x=2*Math.random()*Math.PI,e.rotation.y=2*Math.random()*Math.PI,e.rotation.z=2*Math.random()*Math.PI,e.scale.x=Math.random()+.5,e.scale.y=Math.random()+.5,e.scale.z=Math.random()+.5,e.userData.velocity=new l.Vector3,e.userData.velocity.x=.01*Math.random()-.005,e.userData.velocity.y=.01*Math.random()-.005,e.userData.velocity.z=.01*Math.random()-.005,x.add(e)}s(void 0,void 0,void 0,(function*(){const e=new l.TextureLoader;w=yield e.loadAsync(p);const t=new l.SphereGeometry(1e3),n=new l.MeshBasicMaterial({map:w,side:l.BackSide});g=new l.Mesh(t,n),v.add(g)})),h=new l.Raycaster,m=new l.WebGLRenderer({antialias:!0}),m.setPixelRatio(window.devicePixelRatio),m.setSize(window.innerWidth,window.innerHeight),m.setAnimationLoop(T),m.autoClearColor=!1,m.xr.enabled=!0,m.xr.addEventListener("sessionstart",R),y.appendChild(m.domElement),M=m.xr.getController(0);M.addEventListener("selectstart",(()=>{M.userData.isSelecting=!0})),M.addEventListener("selectend",(()=>{M.userData.isSelecting=!1})),M.addEventListener("connected",(e=>{const t=(e=>{let t,n;switch(e.targetRayMode){case"tracked-pointer":return t=new l.BufferGeometry,t.setAttribute("position",new l.Float32BufferAttribute([0,0,0,0,0,-1],3)),t.setAttribute("color",new l.Float32BufferAttribute([.5,.5,.5,0,0,0],3)),n=new l.LineBasicMaterial({vertexColors:!0,blending:l.AdditiveBlending}),new l.Line(t,n);case"gaze":return t=new l.RingGeometry(.02,.04,32).translate(0,0,-1),n=new l.MeshBasicMaterial({opacity:.5,transparent:!0}),new l.Mesh(t,n)}})(e.data);t&&M.add(t)})),M.addEventListener("disconnected",(()=>{M.remove(M.children[0])})),v.add(M);const n=new d.XRControllerModelFactory;S=m.xr.getControllerGrip(0),S.add(n.createControllerModel(S)),v.add(S),window.addEventListener("resize",L),document.body.appendChild(c.VRButton.createButton(m,{optionalFeatures:[]}))})()},246:(e,t,n)=>{n.r(t),n.d(t,{VRButton:()=>o});class o{static createButton(e,t={}){const n=document.createElement("button");function r(){n.style.display="",n.style.cursor="auto",n.style.left="calc(50% - 75px)",n.style.width="150px",n.onmouseenter=null,n.onmouseleave=null,n.onclick=null}function i(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator)return n.id="VRButton",n.style.display="none",i(n),navigator.xr.isSessionSupported("immersive-vr").then((function(i){i?function(){let o=null;async function r(t){t.addEventListener("end",i),await e.xr.setSession(t),n.textContent="EXIT VR",o=t}function i(){o.removeEventListener("end",i),n.textContent="ENTER VR",o=null}n.style.display="",n.style.cursor="pointer",n.style.left="calc(50% - 50px)",n.style.width="100px",n.textContent="ENTER VR";const a={...t,optionalFeatures:["local-floor","bounded-floor","layers",...t.optionalFeatures||[]]};n.onmouseenter=function(){n.style.opacity="1.0"},n.onmouseleave=function(){n.style.opacity="0.5"},n.onclick=function(){null===o?navigator.xr.requestSession("immersive-vr",a).then(r):(o.end(),void 0!==navigator.xr.offerSession&&navigator.xr.offerSession("immersive-vr",a).then(r).catch((e=>{console.warn(e)})))},void 0!==navigator.xr.offerSession&&navigator.xr.offerSession("immersive-vr",a).then(r).catch((e=>{console.warn(e)}))}():(r(),n.textContent="VR NOT SUPPORTED"),i&&o.xrSessionIsGranted&&n.click()})).catch((function(e){r(),console.warn("Exception when trying to call xr.isSessionSupported",e),n.textContent="VR NOT ALLOWED"})),n;{const e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",i(e),e}}static registerSessionGrantedListener(){if("undefined"!=typeof navigator&&"xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",(()=>{o.xrSessionIsGranted=!0}))}}}o.xrSessionIsGranted=!1,o.registerSessionGrantedListener()}},n={};function o(e){var r=n[e];if(void 0!==r)return r.exports;var i=n[e]={exports:{}};return t[e].call(i.exports,i,i.exports,o),i.exports}o.m=t,e=[],o.O=(t,n,r,i)=>{if(!n){var a=1/0;for(d=0;d<e.length;d++){for(var[n,r,i]=e[d],s=!0,l=0;l<n.length;l++)(!1&i||a>=i)&&Object.keys(o.O).every((e=>o.O[e](n[l])))?n.splice(l--,1):(s=!1,i<a&&(a=i));if(s){e.splice(d--,1);var c=r();void 0!==c&&(t=c)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[n,r,i]},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={766:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var r,i,[a,s,l]=n,c=0;if(a.some((t=>0!==e[t]))){for(r in s)o.o(s,r)&&(o.m[r]=s[r]);if(l)var d=l(o)}for(t&&t(n);c<a.length;c++)i=a[c],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return o.O(d)},n=self.webpackChunkthreejs_extra_samples=self.webpackChunkthreejs_extra_samples||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var r=o.O(void 0,[867],(()=>o(424)));r=o.O(r)})();